stages:
  - release

release:
  stage: release
  tags:
    - usody_worker
  only:
    - tags
  script:
    - /etc/poetry/bin/poetry version $CI_COMMIT_TAG
    - git cliff -o CHANGELOG.md
    - /etc/poetry/bin/poetry config pypi-token.pypi $POETRY_PYPI_TOKEN_PYPI
    - /etc/poetry/bin/poetry publish --build
  artifacts:
    paths:
      - dist/*.tar.gz
      - dist/*.whl
      - CHANGELOG.md
